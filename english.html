<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ©é˜¿å§¨çš„è‹±è¯­å°è¯¾å ‚</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: 'Comic Sans MS', 'Verdana', sans-serif; /* ç”¨ä¸€ç§çœ‹èµ·æ¥æ¯”è¾ƒå¯çˆ±çš„å­—ä½“ */
            background-color: #e0f7fa;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            align-items: center;
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        header {
            background-color: #00bcd4;
            color: white;
            width: 100%;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        main {
            flex: 1; /* æ’‘å¼€ä¸­é—´åŒºåŸŸ */
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 4px solid #fff;
            transition: 0.3s;
        }

        /* è§’è‰²é€‰æ‹©é¡µé¢çš„æŒ‰é’® */
        .role-btn {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 15px 0;
            border: none;
            border-radius: 15px;
            font-size: 20px;
            cursor: pointer;
            color: white;
            transition: transform 0.2s;
        }
        .role-xiaojiu { background-color: #ff9800; } /* æ©™è‰² */
        .role-doudou { background-color: #2196f3; }  /* è“è‰² */
        .role-btn:hover { transform: scale(1.05); }

        /* å­¦ä¹ é¡µé¢å…ƒç´  */
        .robot-icon { font-size: 80px; display: block; margin-bottom: 10px; animation: bounce 2s infinite; }
        .word-en { font-size: 48px; color: #333; margin: 10px 0; font-weight: bold; }
        .word-cn { font-size: 24px; color: #666; margin-bottom: 30px; }
        
        .action-btn {
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 5px;
            color: white;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        .btn-listen { background-color: #00bcd4; }
        .btn-speak { background-color: #ff4081; }
        .btn-next { background-color: #4caf50; display: none; margin-top: 20px; width: 80%; }

        .status-text { margin-top: 20px; font-size: 18px; min-height: 24px; color: #555; }
        .correct-msg { color: #4caf50; font-weight: bold; font-size: 22px; }

        /* åº•éƒ¨ç‰ˆæƒ */
        footer {
            padding: 15px;
            color: #7f8c8d;
            font-size: 14px;
            text-align: center;
            background: rgba(255,255,255,0.6);
            width: 100%;
        }

        /* éšè—/æ˜¾ç¤ºæ§åˆ¶ */
        .hidden { display: none !important; }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>

    <header>
        <h2>ğŸ”¤ å¿«ä¹å­¦è‹±è¯­</h2>
    </header>

    <main>
        <div id="select-screen" class="card">
            <h2>è°æ¥å­¦ä¹ å‘€ï¼Ÿ</h2>
            <button class="role-btn role-xiaojiu" onclick="startGame('xiaojiu')">
                ğŸ‘¦ æˆ‘æ˜¯å°ä¹<br><span style="font-size:14px">(ä¸€å¹´çº§)</span>
            </button>
            <button class="role-btn role-doudou" onclick="startGame('doudou')">
                ğŸ§‘â€ğŸ“ æˆ‘æ˜¯æ–—æ–—<br><span style="font-size:14px">(å…­å¹´çº§)</span>
            </button>
        </div>

        <div id="study-screen" class="card hidden">
            <span class="robot-icon">ğŸ¤–</span>
            <div class="word-en" id="display-word">Apple</div>
            <div class="word-cn" id="display-cn">è‹¹æœ</div>

            <div>
                <button class="action-btn btn-listen" onclick="playAudio()">ğŸ‘‚ å¬2é</button>
                <button class="action-btn btn-speak" onclick="startRecord()">ğŸ¤ æˆ‘æ¥è¯»</button>
            </div>

            <div id="status-box" class="status-text">è¯·å…ˆå¬æœºå™¨äººè¯»ä¸€éå“¦~</div>

            <button id="next-btn" class="action-btn btn-next" onclick="nextWord()">âœ¨å¤ªæ£’äº†ï¼ä¸‹ä¸€ä¸ª â¡</button>
            
            <div style="margin-top: 20px;">
                <button onclick="goHome()" style="background:none; border:none; color:#999; cursor:pointer; text-decoration:underline;">â¬… è¿”å›é€‰è§’è‰²</button>
            </div>
        </div>
        
        <div id="finish-screen" class="card hidden">
            <h1>ğŸ‰ å¤ªå‰å®³äº†ï¼</h1>
            <p>ä»Šå¤©çš„å•è¯å…¨éƒ½å­¦ä¼šå•¦ï¼</p>
            <button class="role-btn role-xiaojiu" onclick="goHome()">å†ç©ä¸€æ¬¡</button>
        </div>
    </main>

    <footer>
        â¤ è¿™æ˜¯éŸ©é˜¿å§¨ä¸ºæ–—æ–—å’Œå°ä¹åšçš„
    </footer>

    <script>
        // --- 1. æ•°æ®å‡†å¤‡ ---
        // å°ä¹çš„å•è¯åº“ (ä¸€å¹´çº§éš¾åº¦)
        const wordsXiaoJiu = [
            { en: "Apple", cn: "è‹¹æœ" },
            { en: "Cat", cn: "çŒ«" },
            { en: "Dog", cn: "ç‹—" },
            { en: "Red", cn: "çº¢è‰²" },
            { en: "Book", cn: "ä¹¦" }
        ];

        // æ–—æ–—çš„å•è¯åº“ (å…­å¹´çº§éš¾åº¦)
        const wordsDouDou = [
            { en: "Robot", cn: "æœºå™¨äºº" },
            { en: "Science", cn: "ç§‘å­¦" },
            { en: "History", cn: "å†å²" },
            { en: "Planet", cn: "è¡Œæ˜Ÿ" },
            { en: "Create", cn: "åˆ›é€ " }
        ];

        // --- 2. çŠ¶æ€ç®¡ç† ---
        let currentList = [];
        let currentIndex = 0;
        let isSpeaking = false; // é˜²æ­¢é‡å¤ç‚¹å‡»

        // --- 3. æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ---

        // å¼€å§‹æ¸¸æˆï¼Œåˆå§‹åŒ–
        function startGame(role) {
            if (role === 'xiaojiu') {
                currentList = wordsXiaoJiu;
            } else {
                currentList = wordsDouDou;
            }
            currentIndex = 0; // é‡ç½®åˆ°ç¬¬ä¸€ä¸ªè¯
            
            // åˆ‡æ¢ç•Œé¢
            document.getElementById('select-screen').classList.add('hidden');
            document.getElementById('finish-screen').classList.add('hidden');
            document.getElementById('study-screen').classList.remove('hidden');

            loadWord();
        }

        // åŠ è½½å½“å‰å•è¯åˆ°å±å¹•
        function loadWord() {
            const item = currentList[currentIndex];
            document.getElementById('display-word').innerText = item.en;
            document.getElementById('display-cn').innerText = item.cn;
            
            // é‡ç½®çŠ¶æ€
            document.getElementById('status-box').innerText = "è¯·ç‚¹å‡»â€œå¬2éâ€";
            document.getElementById('status-box').className = "status-text";
            document.getElementById('next-btn').style.display = 'none'; // éšè—ä¸‹ä¸€é¢˜æŒ‰é’®
        }

        // æœºå™¨äººè¯»ä¸¤é
        function playAudio() {
            if (isSpeaking) return;
            
            const word = currentList[currentIndex].en;
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'en-US';
            utterance.rate = 0.8; 

            isSpeaking = true;
            document.getElementById('status-box').innerText = "ğŸ§ æ­£åœ¨æ’­æ”¾...";

            // è¯»ç¬¬1é
            window.speechSynthesis.speak(utterance);
            
            // è¯»ç¬¬2é (ç¨å¾®å»¶è¿Ÿä¸€ç‚¹ç‚¹ï¼Œåˆ©ç”¨é˜Ÿåˆ—)
            const utterance2 = new SpeechSynthesisUtterance(word);
            utterance2.lang = 'en-US';
            utterance2.rate = 0.8;
            
            // è¿™é‡ŒåŠ ä¸ªå°åœé¡¿çš„æŠ€å·§ï¼šè®©å®ƒè¯»ä¸€ä¸ªç©ºçš„çŸ­è¯­ï¼Œæˆ–è€…ç›´æ¥åˆ©ç”¨æµè§ˆå™¨çš„é˜Ÿåˆ—æœºåˆ¶
            // ä¸ºäº†æ›´è‡ªç„¶ï¼Œæˆ‘ä»¬æ‰‹åŠ¨ç”¨setTimeout
            setTimeout(() => {
                window.speechSynthesis.speak(utterance2);
                isSpeaking = false;
                document.getElementById('status-box').innerText = "ğŸ¤ è¯¥ä½ è¯»å•¦ï¼ç‚¹â€œæˆ‘æ¥è¯»â€";
            }, 1200);
        }

        // å¬å†™åŠŸèƒ½
        function startRecord() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("æŠ±æ­‰ï¼Œè¯·ç”¨ç”µè„‘Chromeæµè§ˆå™¨æˆ–å®‰å“æ‰‹æœºä½“éªŒè¯­éŸ³åŠŸèƒ½ã€‚");
                return;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.start();

            recognition.onstart = function() {
                document.getElementById('status-box').innerText = "ğŸ‘‚ æ­£åœ¨å¬ï¼Œè¯·å¤§å£°è¯»...";
                document.getElementById('status-box').style.color = "blue";
            };

            recognition.onresult = function(event) {
                const spoken = event.results[0][0].transcript;
                const target = currentList[currentIndex].en;

                // ç®€å•çš„æ¸…ç†æ¯”è¾ƒ (å¿½ç•¥å¤§å°å†™å’Œæ ‡ç‚¹)
                const cleanSpoken = spoken.trim().toLowerCase().replace(/[^a-z]/g, '');
                const cleanTarget = target.trim().toLowerCase().replace(/[^a-z]/g, '');

                if (cleanSpoken === cleanTarget) {
                    // ç­”å¯¹äº†ï¼
                    document.getElementById('status-box').innerHTML = "<span class='correct-msg'>ğŸ‰ è¯»å¯¹å•¦ï¼(" + spoken + ")</span>";
                    document.getElementById('next-btn').style.display = 'inline-block'; // æ˜¾ç¤ºä¸‹ä¸€é¢˜æŒ‰é’®
                    
                    // æ’’èŠ±
                    fireConfetti();
                } else {
                    // ç­”é”™äº†
                    document.getElementById('status-box').innerText = "âŒ æ²¡å¬æ¸…ï¼Œå¥½åƒè¯»æˆäº† " + spoken + "ï¼Œå†è¯•ä¸€æ¬¡ï¼Ÿ";
                    document.getElementById('status-box').style.color = "red";
                }
            };
        }

        // ä¸‹ä¸€ä¸ªå•è¯
        function nextWord() {
            currentIndex++;
            if (currentIndex >= currentList.length) {
                // å­¦å®Œäº†ï¼
                document.getElementById('study-screen').classList.add('hidden');
                document.getElementById('finish-screen').classList.remove('hidden');
                fireConfetti(); // å†æ’’ä¸€æ¬¡èŠ±
            } else {
                loadWord();
            }
        }

        // è¿”å›é¦–é¡µ
        function goHome() {
            document.getElementById('study-screen').classList.add('hidden');
            document.getElementById('finish-screen').classList.add('hidden');
            document.getElementById('select-screen').classList.remove('hidden');
        }

        // æ’’èŠ±å·¥å…·å‡½æ•°
        function fireConfetti() {
            var duration = 2 * 1000;
            var end = Date.now() + duration;

            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 }
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 }
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }
    </script>
</body>
</html>